# llyrtkframework

Avalonia + Prism ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã®ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

## æ¦‚è¦

llyrtkframework ã¯ã€.NET 8.0 ãƒ™ãƒ¼ã‚¹ã® Avalonia MVVM ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’åŠ é€Ÿã™ã‚‹ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œã®çµ±åˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

### ä¸»ãªç‰¹å¾´

- ğŸš€ **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ãƒ‡ã‚£**: å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã«å¿…è¦ãªæ©Ÿèƒ½ã‚’ã™ã¹ã¦æ­è¼‰
- ğŸ”Œ **Prism.Avaloniaå®Œå…¨å¯¾å¿œ**: ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã§DIã‚³ãƒ³ãƒ†ãƒŠã«ä¸€æ‹¬ç™»éŒ²
- ğŸ“¦ **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ**: å¿…è¦ãªæ©Ÿèƒ½ã ã‘ã‚’é¸æŠå¯èƒ½
- ğŸ“š **åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«è©³ç´°ãªREADMEã¨ä½¿ç”¨ä¾‹
- ğŸ¯ **Result<T>ãƒ‘ã‚¿ãƒ¼ãƒ³**: ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âš¡ **ReactiveUIçµ±åˆ**: ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å¯¾å¿œ
- ğŸ”’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: AES-256-GCMæš—å·åŒ–ã€DPAPIçµ±åˆ
- ğŸ”„ **GitHubçµ±åˆ**: ãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸã¨ã‚¢ãƒ—ãƒªæ›´æ–°ãƒã‚§ãƒƒã‚¯

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§

### åŸºæœ¬æ©Ÿèƒ½

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | èª¬æ˜ | README |
|----------|------|--------|
| **Logging** | Serilogçµ±åˆãƒ­ã‚®ãƒ³ã‚° | [README](llyrtkframework/Logging/README.md) |
| **Results** | Result<T>ãƒ‘ã‚¿ãƒ¼ãƒ³ | [README](llyrtkframework/Results/README.md) |
| **Guard** | å¼•æ•°æ¤œè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼ | [README](llyrtkframework/Guard/README.md) |
| **Domain** | Entity, ValueObject | [README](llyrtkframework/Domain/README.md) |
| **Time** | IDateTimeProvider | [README](llyrtkframework/Time/README.md) |
| **Specification** | Specificationãƒ‘ã‚¿ãƒ¼ãƒ³ | [README](llyrtkframework/Specification/README.md) |
| **Validation** | FluentValidationçµ±åˆ | [README](llyrtkframework/Validation/README.md) |
| **Resilience** | Pollyçµ±åˆï¼ˆãƒªãƒˆãƒ©ã‚¤ã€CBï¼‰ | [README](llyrtkframework/Resilience/README.md) |

### ãƒ‡ãƒ¼ã‚¿ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | èª¬æ˜ | README |
|----------|------|--------|
| **Caching** | ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ | [README](llyrtkframework/Caching/README.md) |
| **Configuration** | è¨­å®šç®¡ç† | [README](llyrtkframework/Configuration/README.md) |
| **StateManagement** | çŠ¶æ…‹ç®¡ç†ãƒ»æ°¸ç¶šåŒ– | [README](llyrtkframework/StateManagement/README.md) |
| **DataAccess** | Repository, Unit of Work | [README](llyrtkframework/DataAccess/README.md) |
| **FileManagement** | ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã€GitHubåŒæœŸ | [README](llyrtkframework/FileManagement/README.md) |

### UI/MVVM

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | èª¬æ˜ | README |
|----------|------|--------|
| **Mvvm** | ViewModelBase, Commands | [README](llyrtkframework/Mvvm/README.md) |
| **Events** | EventAggregator | [README](llyrtkframework/Events/README.md) |
| **Notifications** | é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ | [README](llyrtkframework/Notifications/README.md) |
| **Localization** | å¤šè¨€èªå¯¾å¿œï¼ˆi18nï¼‰ | [README](llyrtkframework/Localization/README.md) |
| **Workflow** | Pipelineãƒ‘ã‚¿ãƒ¼ãƒ³ | [README](llyrtkframework/Workflow/README.md) |

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | èª¬æ˜ | README |
|----------|------|--------|
| **Application** | ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã€èµ·å‹•åˆ¶å¾¡ | [README](llyrtkframework/Application/README.md) |
| **Security** | æš—å·åŒ–ã€ãƒãƒƒã‚·ãƒ¥ã€ã‚»ã‚­ãƒ¥ã‚¢ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | [README](llyrtkframework/Security/README.md) |
| **Diagnostics** | ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€è¨ºæ–­æƒ…å ± | [README](llyrtkframework/Diagnostics/README.md) |
| **Update** | GitHub Releasesæ›´æ–°ãƒã‚§ãƒƒã‚¯ | [README](llyrtkframework/Update/README.md) |
| **PrismIntegration** | Prism.Avaloniaçµ±åˆ | [README](llyrtkframework/PrismIntegration/README.md) |

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/yourname/llyrtkframework.git

# ã¾ãŸã¯ NuGet ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦å‚ç…§
dotnet add reference path/to/llyrtkframework/llyrtkframework.csproj
```

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```csharp
using llyrtkframework.PrismIntegration;
using Prism.Ioc;

public class App : PrismApplication
{
    protected override Window CreateShell()
    {
        return Container.Resolve<MainWindow>();
    }

    protected override void RegisterTypes(IContainerRegistry containerRegistry)
    {
        // ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å…¨ä½“ã‚’ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã§ç™»éŒ²
        containerRegistry.RegisterLlyrtkFramework(options =>
        {
            options.ApplicationInfo = new ApplicationInfo(
                name: "MyApp",
                version: new Version(1, 0, 0)
            );

            options.ConfigureSerilog = config =>
            {
                config
                    .MinimumLevel.Information()
                    .WriteTo.Console()
                    .WriteTo.File("logs/app.log", rollingInterval: RollingInterval.Day);
            };
        });

        // ã‚¢ãƒ—ãƒªå›ºæœ‰ã®ã‚µãƒ¼ãƒ“ã‚¹
        containerRegistry.Register<IDialogService, PrismDialogService>();
        containerRegistry.Register<INavigationService, PrismNavigationService>();
    }
}
```

## ViewModelã®ä¾‹

```csharp
public class MainViewModel : ViewModelBase
{
    private readonly IFileManager _fileManager;
    private readonly INotificationService _notificationService;
    private readonly ILogger<MainViewModel> _logger;

    public MainViewModel(
        IFileManager fileManager,
        INotificationService notificationService,
        ILogger<MainViewModel> logger)
    {
        _fileManager = fileManager;
        _notificationService = notificationService;
        _logger = logger;

        SaveCommand = new AsyncDelegateCommand(SaveAsync);
    }

    public AsyncDelegateCommand SaveCommand { get; }

    private async Task SaveAsync()
    {
        try
        {
            IsBusy = true;

            var result = await _fileManager.SaveAsync("data.json", _data);
            if (result.IsSuccess)
            {
                await _notificationService.SendAsync(
                    "æˆåŠŸ",
                    "ä¿å­˜ã—ã¾ã—ãŸ",
                    NotificationType.Success
                );
            }
            else
            {
                _logger.LogError("Save failed: {Error}", result.ErrorMessage);
            }
        }
        finally
        {
            IsBusy = false;
        }
    }
}
```

## ä¸»è¦æ©Ÿèƒ½

### 3ãƒ•ã‚§ãƒ¼ã‚ºèµ·å‹•

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã‚’3ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‘ã¦ç®¡ç†ï¼š

1. **Pre-boot**: Mutexãƒã‚§ãƒƒã‚¯ã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒªã‚«ãƒãƒªãƒ¼ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
2. **Core Init**: DIç™»éŒ²ã€è¨­å®šèª­ã¿è¾¼ã¿ã€ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–
3. **UI Setup**: GitHubåŒæœŸã€æ›´æ–°ãƒã‚§ãƒƒã‚¯ã€UIåˆæœŸåŒ–

```csharp
var bootstrapper = new ApplicationBootstrapper(logger);

// Pre-boot
bootstrapper.AddPreBootTask(new CheckApplicationInstanceTask(...));
bootstrapper.AddPreBootTask(new CrashRecoveryTask(...));
bootstrapper.AddPreBootTask(new VersionCheckTask(...));

// Core Init
bootstrapper.AddCoreInitTask(new LoadConfigurationTask(...));

// UI Setup
bootstrapper.AddUiSetupTask(new GitHubSyncTask(...));
bootstrapper.AddUiSetupTask(new CheckUpdateTask(...));

await bootstrapper.BootstrapAsync();
```

### ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã¨GitHubçµ±åˆ

```csharp
var fileManager = new FileManager(logger, backupTrigger);

// ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
await fileManager.SaveAsync("data.json", content);
await fileManager.LoadAsync<MyData>("data.json");

// GitHubã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
await fileManager.DownloadFromGitHubAsync(
    "owner/repo",
    "data/input.json",
    "local/input.json"
);

// è‡ªå‹•åŒæœŸ
var trigger = new GitHubBackupTrigger(
    "owner/repo",
    "data/input.json",
    pollInterval: TimeSpan.FromMinutes(30),
    logger
);
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

```csharp
// ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–
var encryptionService = new EncryptionService(logger);
var key = encryptionService.GenerateKey();
var encrypted = encryptionService.EncryptString("secret", key);

// ã‚»ã‚­ãƒ¥ã‚¢ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆDPAPIï¼‰
var secureStorage = new SecureStorage(logger, storagePath);
await secureStorage.SaveAsync("ApiKey", "sk-xxx");
var apiKey = await secureStorage.LoadAsync("ApiKey");
```

### è¨ºæ–­ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```csharp
// ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
var exceptionHandler = new GlobalExceptionHandler(logger, appDataPath);
AppDomain.CurrentDomain.UnhandledException += (s, e) =>
{
    if (e.ExceptionObject is Exception ex)
    {
        exceptionHandler.HandleExceptionAsync(ex, "AppDomain").Wait();
    }
};

// è¨ºæ–­æƒ…å ±ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
var exporter = new DiagnosticExporter(logger, appDataPath);
await exporter.ExportDiagnosticsAsync("diagnostics.zip");
```

### æ›´æ–°ãƒã‚§ãƒƒã‚¯

```csharp
var updateChecker = new UpdateChecker(logger, httpClient, "owner", "repo");
var result = await updateChecker.CheckForUpdateAsync(currentVersion);

if (result.IsSuccess && result.Value!.IsUpdateAvailable)
{
    Console.WriteLine($"Update available: {result.Value.LatestVersion}");
}
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Presentation Layer            â”‚
â”‚  (Avalonia Views, ViewModels, Prism)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Application Layer               â”‚
â”‚  (UseCases, Services, Orchestration)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            Domain Layer                  â”‚
â”‚  (Entities, ValueObjects, Domain Logic) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Infrastructure Layer              â”‚
â”‚  (FileSystem, GitHub, Security, Cache)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾å­˜é–¢ä¿‚

- **Avalonia UI** 11.x
- **Prism.Avalonia** 9.x
- **ReactiveUI** 22.x
- **DryIoc** (Prismãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
- **Serilog** 4.x
- **FluentValidation** 12.x
- **Polly** 8.x
- **.NET 8.0**

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. DIã‚³ãƒ³ãƒ†ãƒŠã®æ´»ç”¨

```csharp
// è‰¯ã„ä¾‹: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
public class MyViewModel : ViewModelBase
{
    public MyViewModel(IFileManager fileManager, ILogger<MyViewModel> logger)
    {
        // DI ã§è‡ªå‹•æ³¨å…¥
    }
}

// æ‚ªã„ä¾‹: ç›´æ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
public class BadViewModel : ViewModelBase
{
    private readonly FileManager _fileManager = new FileManager(...);  // NG
}
```

### 2. Result<T>ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½¿ç”¨

```csharp
// è‰¯ã„ä¾‹: Resultã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
var result = await service.DoSomethingAsync();
if (result.IsFailure)
{
    _logger.LogError("Failed: {Error}", result.ErrorMessage);
    return;
}

// æ‚ªã„ä¾‹: ä¾‹å¤–ã§åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼
try
{
    await service.DoSomethingAsync();
}
catch (Exception ex)  // é€šå¸¸ã®ã‚¨ãƒ©ãƒ¼ã‚’ä¾‹å¤–ã§å‡¦ç† NG
{
    // ...
}
```

### 3. ReactiveUIã®æ´»ç”¨

```csharp
// è‰¯ã„ä¾‹: ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
private string _searchText = string.Empty;
public string SearchText
{
    get => _searchText;
    set => this.RaiseAndSetIfChanged(ref _searchText, value);
}

// WhenAnyValue ã§ç›£è¦–
this.WhenAnyValue(x => x.SearchText)
    .Throttle(TimeSpan.FromMilliseconds(300))
    .Subscribe(async text => await SearchAsync(text));
```

## ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ

```
MyApp/
â”œâ”€â”€ App.axaml.cs              # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ MainWindow.axaml
â”‚   â”œâ”€â”€ MainView.axaml
â”‚   â””â”€â”€ SettingsView.axaml
â”œâ”€â”€ ViewModels/
â”‚   â”œâ”€â”€ MainViewModel.cs
â”‚   â””â”€â”€ SettingsViewModel.cs
â”œâ”€â”€ Services/
â”‚   â””â”€â”€ MyAppService.cs
â”œâ”€â”€ Models/
â”‚   â””â”€â”€ MyData.cs
â””â”€â”€ Resources/
    â”œâ”€â”€ en-US.json
    â””â”€â”€ ja-JP.json
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ­ã‚°ã®ç¢ºèª

```
%LocalAppData%\MyApp\logs\app.log
```

### ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ¬ãƒãƒ¼ãƒˆ

```
%LocalAppData%\MyApp\crash_reports\
```

### è¨ºæ–­æƒ…å ±ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

è¨­å®šç”»é¢ã‹ã‚‰ã€Œè¨ºæ–­æƒ…å ±ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ­ã‚°ãƒ»è¨­å®šãƒ»ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ¬ãƒãƒ¼ãƒˆãŒZIPãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã‚‰ã‚Œã¾ã™ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼

## é–¢é€£ãƒªãƒ³ã‚¯

- [Avalonia UI](https://avaloniaui.net/)
- [Prism Library](https://prismlibrary.com/)
- [ReactiveUI](https://www.reactiveui.net/)
- [Serilog](https://serilog.net/)
